{"version":3,"file":"ConsultaExSomnolencia-DFEpujWU.js","sources":["../../../resources/js/Pages/Consultas/ConsultaExSomnolencia.vue"],"sourcesContent":["<script setup>\nimport AppLayout from \"@/Layouts/AppLayout.vue\";\nimport { reactive, onMounted } from \"vue\";\nimport { fetchData, handleSearchItem } from \"@/helper.js\";\n\ndefineOptions({ layout: AppLayout });\n\nconst state = reactive({\n  endpoints: [\"area\", \"ceco\", \"empresa\", \"planta\", \"unidad\", \"nivel_riesgo\"],\n\n  headers: [\n    {\n      title: \"Rut\",\n      align: \"start\",\n      sortable: true,\n      key: \"rut\",\n    },\n    {\n      title: \"Nombre\",\n      align: \"start\",\n      sortable: true,\n      key: \"nombre\",\n    },\n    {\n      title: \"Apellidos\",\n      align: \"start\",\n      sortable: true,\n      key: \"apellidos\",\n    },\n    {\n      title: \"Empresa\",\n      align: \"start\",\n      sortable: true,\n      key: \"empresa.descripcion\",\n    },\n    {\n      title: \"Nivel de riesgo\",\n      align: \"start\",\n      sortable: true,\n      key: \"nivel_riesgo.descripcion\",\n    },\n    {\n      title: \"Resultado\",\n      align: \"start\",\n      sortable: true,\n      key: \"resultado\",\n    },\n    {\n      title: \"Fecha exámen\",\n      align: \"start\",\n      sortable: true,\n      key: \"fecha_examen\",\n    },\n\n    { title: \"Acciones\", align: \"center\", key: \"actions\" },\n  ],\n\n  searchQuery: {\n    activo: true,\n    area: null,\n    ceco: null,\n    empresa: null,\n    planta: null,\n    rut: null,\n    unidad: null,\n\n    resultado: \"No apto\",\n    nivel_riesgo: null,\n    fecha_examen: { desde: null, hasta: null },\n    fecha_primer: { desde: null, hasta: null },\n    fecha_segundo: { desde: null, hasta: null },\n  },\n\n  rutRules: [\n    (value) => {\n      const regex = /^[0-9]+[-|‐]{1}[0-9kK]{1}$/;\n      if (!regex.test(value)) {\n        return false;\n      }\n\n      // Separar el número y el dígito verificador\n      let splitrut = value.split(\"-\");\n      let num = splitrut[0];\n      let dv = splitrut[1].toLowerCase();\n\n      // Calcular el dígito verificador esperado\n      let m = 0,\n        s = 1;\n      for (; num; num = Math.floor(num / 10)) {\n        s = (s + (num % 10) * (9 - (m++ % 6))) % 11;\n      }\n      let dvEsperado = s ? s - 1 : \"k\";\n      let validate = dv === dvEsperado;\n\n      if (validate) return true;\n      return \"El rut es incorrecto\";\n    },\n  ],\n\n  itemsView: {\n    paciente_id: null,\n    fecha_examen: null,\n    fecha_primer: null,\n    fecha_segundo: null,\n    nivel_riesgo: null,\n    resultado: \"No Apto\",\n    comentario: null,\n  },\n\n  dialog: false,\n  tableItems: [],\n  formItems: [],\n  editedIndex: -1,\n  list: [],\n  valid: null,\n  formTitle: \"Exámenes de Somnolencia\",\n  urlSearch: \"/consulta/exsomnolencia/search\",\n});\n\n//**********\\\\\\\\  LIFE CYCLE HOOKS ////*************/\n/**\n * Initializes the component by calling the 'initialize' function.\n *\n * @function onMounted\n * @returns {void}\n */\nonMounted(async () => {\n  state.list = await fetchData(state.endpoints);\n});\n\n//**********\\\\\\\\ METHODS ////*************/\n\nfunction VerDetalles(item) {\n  state.dialog = true;\n  state.itemsView = { ...item };\n}\nfunction close() {\n  state.dialog = false;\n}\n\n//**********\\\\\\\\  CRUD ////*************/\n\nconst handleSearch = async () => {\n  await handleSearchItem(state);\n};\n</script>\n\n<template>\n  <v-container fluid>\n    <v-card>\n      <v-card-title>\n        <v-toolbar flat>\n          <v-toolbar-title>\n            {{ state.formTitle }}\n          </v-toolbar-title>\n          <v-spacer></v-spacer>\n        </v-toolbar>\n      </v-card-title>\n\n      <v-card-text>\n        <v-sheet color=\"white\" :elevation=\"4\" :class=\"'rounded-lg ma-2 pa-2'\">\n          <!-- SEARCH -->\n          <v-container fluid>\n            <v-card-text>\n              <v-row>\n                <v-col>\n                  <v-text-field\n                    label=\"Rut\"\n                    variant=\"underlined\"\n                    :rules=\"state.rutRules\"\n                    v-model=\"state.searchQuery.rut\"\n                  ></v-text-field>\n                  <v-select\n                    :items=\"state.list.empresa\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                    label=\"Empresa\"\n                    v-model=\"state.searchQuery.empresa\"\n                    variant=\"underlined\"\n                    clearable\n                  ></v-select>\n                  <v-select\n                    label=\"Unidad\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.unidad\"\n                    :items=\"state.list.unidad\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                  ></v-select>\n                  <v-select\n                    label=\"Area\"\n                    v-model=\"state.searchQuery.area\"\n                    variant=\"underlined\"\n                    :items=\"state.list.area\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                  ></v-select>\n                  <v-select\n                    label=\"Area (cecos)\"\n                    v-model=\"state.searchQuery.ceco\"\n                    variant=\"underlined\"\n                    :items=\"state.list.ceco\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                  ></v-select>\n                  <v-switch\n                    v-model=\"state.searchQuery.activo\"\n                    hide-details\n                    true-value=\"true\"\n                    false-value=\"false\"\n                    class=\"ml-4 mb-4\"\n                    variant=\"underlined\"\n                    color=\"green-darken-3\"\n                    value=\"true\"\n                    :inset=\"true\"\n                    :label=\"`Paciente: ${state.searchQuery.activo.toString()}`\"\n                  ></v-switch>\n                  <v-switch\n                    v-model=\"state.searchQuery.resultado\"\n                    hide-details\n                    true-value=\"Apto\"\n                    false-value=\"No apto\"\n                    class=\"ml-4 mb-4\"\n                    variant=\"underlined\"\n                    color=\"green-darken-3\"\n                    value=\"No apto\"\n                    :inset=\"true\"\n                    :label=\"`Resultado: ${state.searchQuery.resultado.toString()}`\"\n                  ></v-switch>\n                </v-col>\n\n                <v-col>\n                  <v-select\n                    label=\"Nivel de Riesgo\"\n                    v-model=\"state.searchQuery.nivel_riesgo\"\n                    variant=\"underlined\"\n                    :items=\"state.list.nivel_riesgo\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                  ></v-select>\n                  <v-text-field\n                    label=\"Fecha exámen (desde)\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.fecha_examen.desde\"\n                    type=\"date\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha exámen (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    v-model=\"state.searchQuery.fecha_examen.hasta\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha primer exámen (desde)\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.fecha_primer.desde\"\n                    type=\"date\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha primer exámen (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    v-model=\"state.searchQuery.fecha_primer.hasta\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha segundo exámen (desde)\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.fecha_segundo.desde\"\n                    type=\"date\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha segundo exámen (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    v-model=\"state.searchQuery.fecha_segundo.hasta\"\n                  ></v-text-field>\n                </v-col>\n              </v-row>\n            </v-card-text>\n            <v-card-actions>\n              <v-btn\n                prepend-icon=\"mdi-file-search\"\n                variant=\"underlined\"\n                color=\"#662D91\"\n                :loading=\"state.loading\"\n                @click=\"handleSearch\"\n              >\n                Buscar\n              </v-btn>\n\n              <v-btn\n                prepend-icon=\"mdi-microsoft-excel\"\n                variant=\"underlined\"\n                color=\"#662D91\"\n              >\n                <download-excel :data=\"state.tableItems\" name=\"consulta_somnolencia.xls\">\n                  Bajar archivo\n                </download-excel>\n              </v-btn>\n            </v-card-actions>\n          </v-container>\n\n          <!-- TABLA -->\n          <v-container fluid>\n            <v-data-table\n              :headers=\"state.headers\"\n              :items=\"state.tableItems\"\n              :sort-by=\"[{ key: 'apellidos', order: 'asc' }]\"\n            >\n              <template v-slot:item.actions=\"{ item }\">\n                <v-tooltip text=\"Ver detalles\" location=\"top\">\n                  <template v-slot:activator=\"{ props }\">\n                    <v-btn\n                      v-bind=\"props\"\n                      density=\"compact\"\n                      color=\"#662D91\"\n                      class=\"mr-2 ml-2\"\n                      :icon=\"'mdi-eye'\"\n                      @click=\"VerDetalles(item)\"\n                    ></v-btn>\n                  </template>\n                </v-tooltip>\n              </template>\n            </v-data-table>\n          </v-container>\n        </v-sheet>\n      </v-card-text>\n    </v-card>\n\n    <!-- FORM -->\n    <v-container>\n      <v-dialog v-model=\"state.dialog\">\n        <v-sheet elevation=\"4\" class=\"ma-4 pa-4\">\n          <v-card>\n            <v-form readonly>\n              <v-sheet elevation=\"2\" class=\"ma-2 pa-2\">\n                <v-card-title>\n                  <span class=\"text-h5\"> Consulta exámenes SOMNOLENCIA </span>\n                </v-card-title>\n              </v-sheet>\n\n              <v-card-text>\n                <!-- ********** -->\n\n                <v-row>\n                  <v-col>\n                    <v-text-field\n                      v-model=\"state.itemsView.nivel_riesgo\"\n                      label=\"Nivel de Riesgo\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.resultado\"\n                      label=\"Resultado\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.comentario\"\n                      label=\"Comentario\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                  </v-col>\n\n                  <v-col>\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_examen\"\n                      label=\"Fecha Examen\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_primer\"\n                      label=\"Fecha primer\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_segundo\"\n                      label=\"Fecha segundo\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                  </v-col>\n                </v-row>\n\n                <!-- ********** -->\n              </v-card-text>\n\n              <v-sheet elevation=\"2\" class=\"ma-2 pa-2\">\n                <v-card-actions>\n                  <v-btn\n                    class=\"mr-2 ml-2\"\n                    color=\"#662D91\"\n                    text=\"Cerrar\"\n                    variant=\"underlined\"\n                    @click=\"close()\"\n                  ></v-btn>\n                </v-card-actions>\n              </v-sheet>\n            </v-form>\n          </v-card>\n        </v-sheet>\n      </v-dialog>\n    </v-container>\n  </v-container>\n</template>\n"],"names":["state","reactive","value","splitrut","num","dv","s","dvEsperado","onMounted","fetchData","VerDetalles","item","close","handleSearch","handleSearchItem"],"mappings":"+cAOA,MAAMA,EAAQC,EAAS,CACrB,UAAW,CAAC,OAAQ,OAAQ,UAAW,SAAU,SAAU,cAAc,EAEzE,QAAS,CACP,CACE,MAAO,MACP,MAAO,QACP,SAAU,GACV,IAAK,KACN,EACD,CACE,MAAO,SACP,MAAO,QACP,SAAU,GACV,IAAK,QACN,EACD,CACE,MAAO,YACP,MAAO,QACP,SAAU,GACV,IAAK,WACN,EACD,CACE,MAAO,UACP,MAAO,QACP,SAAU,GACV,IAAK,qBACN,EACD,CACE,MAAO,kBACP,MAAO,QACP,SAAU,GACV,IAAK,0BACN,EACD,CACE,MAAO,YACP,MAAO,QACP,SAAU,GACV,IAAK,WACN,EACD,CACE,MAAO,eACP,MAAO,QACP,SAAU,GACV,IAAK,cACN,EAED,CAAE,MAAO,WAAY,MAAO,SAAU,IAAK,SAAW,CACvD,EAED,YAAa,CACX,OAAQ,GACR,KAAM,KACN,KAAM,KACN,QAAS,KACT,OAAQ,KACR,IAAK,KACL,OAAQ,KAER,UAAW,UACX,aAAc,KACd,aAAc,CAAE,MAAO,KAAM,MAAO,IAAM,EAC1C,aAAc,CAAE,MAAO,KAAM,MAAO,IAAM,EAC1C,cAAe,CAAE,MAAO,KAAM,MAAO,IAAM,CAC5C,EAED,SAAU,CACPC,GAAU,CAET,GAAI,CADU,6BACH,KAAKA,CAAK,EACnB,MAAO,GAIT,IAAIC,EAAWD,EAAM,MAAM,GAAG,EAC1BE,EAAMD,EAAS,CAAC,EAChBE,EAAKF,EAAS,CAAC,EAAE,YAAW,EAG5B,EAAI,EACNG,EAAI,EACN,KAAOF,EAAKA,EAAM,KAAK,MAAMA,EAAM,EAAE,EACnCE,GAAKA,EAAKF,EAAM,IAAO,EAAK,IAAM,IAAO,GAE3C,IAAIG,EAAaD,EAAIA,EAAI,EAAI,IAG7B,OAFeD,IAAOE,EAED,GACd,sBACR,CACF,EAED,UAAW,CACT,YAAa,KACb,aAAc,KACd,aAAc,KACd,cAAe,KACf,aAAc,KACd,UAAW,UACX,WAAY,IACb,EAED,OAAQ,GACR,WAAY,CAAE,EACd,UAAW,CAAE,EACb,YAAa,GACb,KAAM,CAAE,EACR,MAAO,KACP,UAAW,0BACX,UAAW,gCACb,CAAC,EASDC,EAAU,SAAY,CACpBR,EAAM,KAAO,MAAMS,EAAUT,EAAM,SAAS,CAC9C,CAAC,EAID,SAASU,EAAYC,EAAM,CACzBX,EAAM,OAAS,GACfA,EAAM,UAAY,CAAE,GAAGW,EACzB,CACA,SAASC,GAAQ,CACfZ,EAAM,OAAS,EACjB,CAIA,MAAMa,EAAe,SAAY,CAC/B,MAAMC,EAAiBd,CAAK,CAC9B"}