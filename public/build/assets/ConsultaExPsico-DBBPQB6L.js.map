{"version":3,"file":"ConsultaExPsico-DBBPQB6L.js","sources":["../../../resources/js/Pages/Consultas/ConsultaExPsico.vue"],"sourcesContent":["<script setup>\nimport AppLayout from \"@/Layouts/AppLayout.vue\";\nimport { reactive, onMounted } from \"vue\";\nimport { fetchData, handleSearchItem } from \"@/helper.js\";\n\ndefineOptions({ layout: AppLayout });\n\nconst state = reactive({\n  endpoints: [\"area\", \"ceco\", \"empresa\", \"planta\", \"unidad\"],\n\n  headers: [\n    {\n      title: \"Rut\",\n      align: \"start\",\n      sortable: true,\n      key: \"rut\",\n    },\n    {\n      title: \"Nombre\",\n      align: \"start\",\n      sortable: true,\n      key: \"nombre\",\n    },\n    {\n      title: \"Apellidos\",\n      align: \"start\",\n      sortable: true,\n      key: \"apellidos\",\n    },\n    {\n      title: \"Empresa\",\n      align: \"start\",\n      sortable: true,\n      key: \"empresa.descripcion\",\n    },\n    {\n      title: \"Fecha solicitud\",\n      align: \"start\",\n      sortable: true,\n      key: \"fecha_solicitud\",\n    },\n    {\n      title: \"Fecha recepción\",\n      align: \"start\",\n      sortable: true,\n      key: \"fecha_recepcion\",\n    },\n    {\n      title: \"Fecha realizacion\",\n      align: \"start\",\n      sortable: true,\n      key: \"fecha_realizacion\",\n    },\n    {\n      title: \"Fecha vencimiento\",\n      align: \"start\",\n      sortable: true,\n      key: \"fecha_vencimiento\",\n    },\n\n    { title: \"Acciones\", align: \"center\", key: \"actions\" },\n  ],\n\n  searchQuery: {\n    activo: \"true\",\n    area: null,\n    ceco: null,\n    empresa: null,\n    planta: null,\n    rut: null,\n    unidad: null,\n\n    fecha_realizacion: {\n      desde: null,\n      hasta: null,\n    },\n    fecha_recepcion: {\n      desde: null,\n      hasta: null,\n    },\n    fecha_solicitud: {\n      desde: null,\n      hasta: null,\n    },\n    fecha_vencimiento: {\n      desde: null,\n      hasta: null,\n    },\n  },\n\n  rutRules: [\n    (value) => {\n      const regex = /^[0-9]+[-|‐]{1}[0-9kK]{1}$/;\n      if (!regex.test(value)) {\n        return false;\n      }\n\n      // Separar el número y el dígito verificador\n      let splitrut = value.split(\"-\");\n      let num = splitrut[0];\n      let dv = splitrut[1].toLowerCase();\n\n      // Calcular el dígito verificador esperado\n      let m = 0,\n        s = 1;\n      for (; num; num = Math.floor(num / 10)) {\n        s = (s + (num % 10) * (9 - (m++ % 6))) % 11;\n      }\n      let dvEsperado = s ? s - 1 : \"k\";\n      let validate = dv == dvEsperado;\n\n      if (validate) return true;\n      return \"El rut es incorrecto\";\n    },\n  ],\n\n  itemsView: {\n    paciente_id: null,\n    tipo_vehiculo: null,\n    contraindicacion: null,\n    fecha_solicitud: null,\n    fecha_realizacion: null,\n    fecha_recepcion: null,\n    fecha_vencimiento: null,\n    comentario: null,\n  },\n\n  dialog: false,\n  tableItems: [],\n  formItems: [],\n  editedIndex: -1,\n  list: [],\n  formTitle: \"Consulta Exámen Psicosensométrico\",\n  urlSearch: \"/consulta/expsico/search\",\n});\n\n//**********\\\\\\\\  LIFE CYCLE HOOKS ////*************/\n/**\n * Initializes the component by calling the 'initialize' function.\n *\n * @function onMounted\n * @returns {void}\n */\nonMounted(async () => {\n  state.list = await fetchData(state.endpoints);\n});\n\n//**********\\\\\\\\ METHODS ////*************/\n\nfunction VerDetalles(item) {\n  state.dialog = true;\n  state.itemsView = { ...item };\n}\nfunction close() {\n  state.dialog = false;\n}\n\n//**********\\\\\\\\  CRUD ////*************/\n\nconst handleSearch = async () => {\n  await handleSearchItem(state);\n};\n</script>\n\n<template>\n  <v-container fluid>\n    <v-card>\n      <v-card-title>\n        <v-toolbar flat>\n          <v-toolbar-title>{{ state.formTitle }} </v-toolbar-title>\n          <v-spacer></v-spacer>\n        </v-toolbar>\n      </v-card-title>\n\n      <v-card-text>\n        <v-sheet color=\"white\" :elevation=\"4\" :class=\"'rounded-lg ma-2 pa-2'\">\n          <!-- SEARCH -->\n          <v-container fluid>\n            <v-card-text>\n              <v-row>\n                <v-col>\n                  <v-text-field\n                    label=\"Rut\"\n                    variant=\"underlined\"\n                    :rules=\"state.rutRules\"\n                    v-model=\"state.searchQuery.rut\"\n                    clearable\n                  ></v-text-field>\n                  <v-select\n                    :items=\"state.list.empresa\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                    label=\"Empresa\"\n                    v-model=\"state.searchQuery.empresa\"\n                    variant=\"underlined\"\n                    clearable\n                  ></v-select>\n                  <v-select\n                    label=\"Unidad\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.unidad\"\n                    :items=\"state.list.unidad\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                    clearable\n                  ></v-select>\n                  <v-select\n                    label=\"Area\"\n                    v-model=\"state.searchQuery.area\"\n                    variant=\"underlined\"\n                    :items=\"state.list.area\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                    clearable\n                  ></v-select>\n                  <v-select\n                    label=\"Area (cecos)\"\n                    v-model=\"state.searchQuery.ceco\"\n                    variant=\"underlined\"\n                    :items=\"state.list.ceco\"\n                    item-title=\"descripcion\"\n                    item-value=\"id\"\n                    clearable\n                  ></v-select>\n                  <v-switch\n                    v-model=\"state.searchQuery.activo\"\n                    hide-details\n                    true-value=\"true\"\n                    false-value=\"false\"\n                    class=\"ml-4 mt-4\"\n                    variant=\"underlined\"\n                    color=\"green-darken-3\"\n                    inset\n                    label=\"Activo\"\n                  ></v-switch>\n                </v-col>\n\n                <v-col>\n                  <v-text-field\n                    label=\"Fecha realizacion (desde)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_realizacion.desde\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha realizacion (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_realizacion.hasta\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha recepción (desde)\"\n                    variant=\"underlined\"\n                    v-model=\"state.searchQuery.fecha_recepcion.desde\"\n                    type=\"date\"\n                    clearable\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha recepción (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_recepcion.hasta\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha solicitud (desde)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_solicitud.desde\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha solicitud (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_solicitud.hasta\"\n                  ></v-text-field>\n                </v-col>\n                <v-col>\n                  <v-text-field\n                    label=\"Fecha vencimiento (desde)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_vencimiento.desde\"\n                  ></v-text-field>\n                  <v-text-field\n                    label=\"Fecha vencimiento (hasta)\"\n                    variant=\"underlined\"\n                    type=\"date\"\n                    clearable\n                    v-model=\"state.searchQuery.fecha_vencimiento.hasta\"\n                  ></v-text-field>\n                </v-col>\n              </v-row>\n            </v-card-text>\n            <v-card-actions>\n              <v-btn\n                prepend-icon=\"mdi-file-search\"\n                variant=\"tonal\"\n                color=\"#009AA4\"\n                :loading=\"state.loading\"\n                @click=\"handleSearch\"\n              >\n                Buscar\n              </v-btn>\n\n              <v-btn prepend-icon=\"mdi-microsoft-excel\" variant=\"tonal\" color=\"#009AA4\">\n                <download-excel :data=\"state.tableItems\" name=\"consulta_expsico.xls\">\n                  Bajar archivo\n                </download-excel>\n              </v-btn>\n            </v-card-actions>\n          </v-container>\n\n          <!-- TABLA -->\n          <v-container fluid>\n            <v-data-table\n              :headers=\"state.headers\"\n              :items=\"state.tableItems\"\n              :sort-by=\"[{ key: 'apellidos', order: 'asc' }]\"\n            >\n              <template v-slot:item.actions=\"{ item }\">\n                <v-tooltip text=\"Ver detalles\" location=\"top\">\n                  <template v-slot:activator=\"{ props }\">\n                    <v-btn\n                      v-bind=\"props\"\n                      density=\"compact\"\n                      color=\"#009AA4\"\n                      class=\"mr-2 ml-2\"\n                      :icon=\"'mdi-eye'\"\n                      @click=\"VerDetalles(item)\"\n                    ></v-btn>\n                  </template>\n                </v-tooltip>\n              </template>\n            </v-data-table>\n          </v-container>\n        </v-sheet>\n      </v-card-text>\n    </v-card>\n\n    <!-- FORM -->\n    <v-container>\n      <v-dialog v-model=\"state.dialog\">\n        <v-sheet elevation=\"4\" class=\"ma-4 pa-4\">\n          <v-card>\n            <v-form readonly>\n              <v-sheet elevation=\"2\" class=\"ma-2 pa-2\">\n                <v-card-title>\n                  <span class=\"text-h5\"> Consulta exámenes Psicosensometricos </span>\n                </v-card-title>\n              </v-sheet>\n\n              <v-card-text>\n                <!-- ********** -->\n\n                <v-row>\n                  <v-col>\n                    <v-text-field\n                      v-model=\"state.itemsView.tipo_vehiculo\"\n                      label=\"Tipo de vehículo\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.contraindicacion\"\n                      label=\"Contraindicacion\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_realizacion\"\n                      label=\"Fecha de realización\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_solicitud\"\n                      label=\"Fecha de solicitud\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                  </v-col>\n\n                  <v-col>\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_recepcion\"\n                      label=\"Fecha recepción\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                    <v-text-field\n                      v-model=\"state.itemsView.fecha_vencimiento\"\n                      label=\"Fecha vencimiento\"\n                      type=\"date\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n\n                    <v-text-field\n                      v-model=\"state.itemsView.comentario\"\n                      label=\"Comentario\"\n                      type=\"text\"\n                      variant=\"underlined\"\n                    ></v-text-field>\n                  </v-col>\n                </v-row>\n\n                <!-- ********** -->\n              </v-card-text>\n\n              <v-sheet elevation=\"2\" class=\"ma-2 pa-2\">\n                <v-card-actions>\n                  <v-btn\n                    class=\"mr-2 ml-2\"\n                    color=\"#009AA4\"\n                    text=\"Cerrar\"\n                    variant=\"tonal\"\n                    @click=\"close()\"\n                  ></v-btn>\n                </v-card-actions>\n              </v-sheet>\n            </v-form>\n          </v-card>\n        </v-sheet>\n      </v-dialog>\n    </v-container>\n  </v-container>\n</template>\n"],"names":["state","reactive","value","splitrut","num","dv","s","dvEsperado","onMounted","fetchData","VerDetalles","item","close","handleSearch","handleSearchItem"],"mappings":"gdAOA,MAAMA,EAAQC,EAAS,CACrB,UAAW,CAAC,OAAQ,OAAQ,UAAW,SAAU,QAAQ,EAEzD,QAAS,CACP,CACE,MAAO,MACP,MAAO,QACP,SAAU,GACV,IAAK,KACN,EACD,CACE,MAAO,SACP,MAAO,QACP,SAAU,GACV,IAAK,QACN,EACD,CACE,MAAO,YACP,MAAO,QACP,SAAU,GACV,IAAK,WACN,EACD,CACE,MAAO,UACP,MAAO,QACP,SAAU,GACV,IAAK,qBACN,EACD,CACE,MAAO,kBACP,MAAO,QACP,SAAU,GACV,IAAK,iBACN,EACD,CACE,MAAO,kBACP,MAAO,QACP,SAAU,GACV,IAAK,iBACN,EACD,CACE,MAAO,oBACP,MAAO,QACP,SAAU,GACV,IAAK,mBACN,EACD,CACE,MAAO,oBACP,MAAO,QACP,SAAU,GACV,IAAK,mBACN,EAED,CAAE,MAAO,WAAY,MAAO,SAAU,IAAK,SAAW,CACvD,EAED,YAAa,CACX,OAAQ,OACR,KAAM,KACN,KAAM,KACN,QAAS,KACT,OAAQ,KACR,IAAK,KACL,OAAQ,KAER,kBAAmB,CACjB,MAAO,KACP,MAAO,IACR,EACD,gBAAiB,CACf,MAAO,KACP,MAAO,IACR,EACD,gBAAiB,CACf,MAAO,KACP,MAAO,IACR,EACD,kBAAmB,CACjB,MAAO,KACP,MAAO,IACR,CACF,EAED,SAAU,CACPC,GAAU,CAET,GAAI,CADU,6BACH,KAAKA,CAAK,EACnB,MAAO,GAIT,IAAIC,EAAWD,EAAM,MAAM,GAAG,EAC1BE,EAAMD,EAAS,CAAC,EAChBE,EAAKF,EAAS,CAAC,EAAE,YAAW,EAG5B,EAAI,EACNG,EAAI,EACN,KAAOF,EAAKA,EAAM,KAAK,MAAMA,EAAM,EAAE,EACnCE,GAAKA,EAAKF,EAAM,IAAO,EAAK,IAAM,IAAO,GAE3C,IAAIG,EAAaD,EAAIA,EAAI,EAAI,IAG7B,OAFeD,GAAME,EAEA,GACd,sBACR,CACF,EAED,UAAW,CACT,YAAa,KACb,cAAe,KACf,iBAAkB,KAClB,gBAAiB,KACjB,kBAAmB,KACnB,gBAAiB,KACjB,kBAAmB,KACnB,WAAY,IACb,EAED,OAAQ,GACR,WAAY,CAAE,EACd,UAAW,CAAE,EACb,YAAa,GACb,KAAM,CAAE,EACR,UAAW,oCACX,UAAW,0BACb,CAAC,EASDC,EAAU,SAAY,CACpBR,EAAM,KAAO,MAAMS,EAAUT,EAAM,SAAS,CAC9C,CAAC,EAID,SAASU,EAAYC,EAAM,CACzBX,EAAM,OAAS,GACfA,EAAM,UAAY,CAAE,GAAGW,EACzB,CACA,SAASC,GAAQ,CACfZ,EAAM,OAAS,EACjB,CAIA,MAAMa,EAAe,SAAY,CAC/B,MAAMC,EAAiBd,CAAK,CAC9B"}