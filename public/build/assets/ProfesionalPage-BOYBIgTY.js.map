{"version":3,"file":"ProfesionalPage-BOYBIgTY.js","sources":["../../../resources/js/Pages/SubPages/ProfesionalPage.vue"],"sourcesContent":["<script setup>\nimport AppLayout from \"@/Layouts/AppLayout.vue\";\nimport Swal from \"sweetalert2/dist/sweetalert2.js\";\nimport { router } from \"@inertiajs/vue3\";\nimport { reactive, ref, onMounted, computed } from \"vue\";\nimport { useDataStore } from \"@/store.js\";\nimport moment from \"moment\";\nimport { useDate } from \"vuetify\";\nimport {\n    fetchAllData,\n    handleRemoveItem,\n    //handleShowItem,\n    handleStoreItem,\n    handleEditItem,\n    closeForm,\n    openToCreate,\n    openToEdit,\n} from \"@/helper.js\";\n\n//**********\\\\\\\\  INI STATE VARIABLES AND CONST ////*************/\n\ndefineOptions({ layout: AppLayout });\n\nconst store = useDataStore();\nconst state = reactive({\n    endpoints: [\"especialidades\"],\n    headers: [\n        { title: \"Rut\", align: \"center\", sortable: true, key: \"rut\" },\n        { title: \"Nombre\", align: \"center\", sortable: true, key: \"nombre\" },\n        {\n            title: \"Apellidos\",\n            align: \"center\",\n            sortable: true,\n            key: \"apellidos\",\n        },\n        {\n            title: \"Especialidad\",\n            align: \"center\",\n            sortable: true,\n            key: \"especialidad_id\",\n        },\n\n        { title: \"Acciones\", sortable: false, align: \"center\", key: \"actions\" },\n    ],\n    validation: {\n        rutRules: [\n            (value) => {\n                const regex = /^[0-9]+[-|‐]{1}[0-9kK]{1}$/;\n                if (!regex.test(value)) {\n                    return false;\n                }\n\n                // Separar el número y el dígito verificador\n                let splitidRut = value.split(\"-\");\n                let num = splitidRut[0];\n                let dv = splitidRut[1].toLowerCase();\n                // Calcular el dígito verificador esperado\n                let m = 0,\n                    s = 1;\n                for (; num; num = Math.floor(num / 10)) {\n                    s = (s + (num % 10) * (9 - (m++ % 6))) % 11;\n                }\n                let dvEsperado = s ? s - 1 : \"k\";\n                const validate = dv === dvEsperado;\n                return validate\n                    ? true\n                    : \"El rut no es válido. Por favor, verifique el formato y los dígitos.\";\n            },\n        ],\n        emailRules: [\n            (value) => {\n                if (value) return true;\n                return \"Se necesita un email.\";\n            },\n            (value) => {\n                if (/.+@.+\\..+/.test(value)) return true;\n                return \"El email debe ser válido.\";\n            },\n        ],\n    },\n    horario: {\n        headers: [\n            {\n                text: \"Día de la semana\",\n                align: \"center\",\n                sortable: true,\n                value: \"dia\",\n            },\n            {\n                text: \"Hora inicio\",\n                align: \"center\",\n                sortable: true,\n                value: \"horaInicio\",\n            },\n            {\n                text: \"Hora término\",\n                align: \"center\",\n                sortable: true,\n                value: \"horaTermino\",\n            },\n            {\n                text: \"Disponible (S/N)\",\n                align: \"center\",\n                sortable: true,\n                value: \"disponible\",\n            },\n        ],\n        items: [\n            {\n                dia: \"Lunes\",\n                horaInicio: \"08:00\",\n                horaTermino: \"17:00\",\n                disponible: \"S\",\n            },\n            {\n                dia: \"Martes\",\n                horaInicio: \"08:00\",\n                horaTermino: \"17:00\",\n                disponible: \"N\",\n            },\n        ],\n    },\n    searchQuery: {\n        rut: null,\n        especialidad_id: null,\n    },\n    editedItem: {\n        rut: null,\n        nombre: null,\n        apellidos: null,\n        dirección: null,\n        email: null,\n        fecha_nacimiento: null,\n        especialidad_id: null,\n        telefono: null,\n        vigente: true\n    },\n    defaultItem: {\n        rut: null,\n        nombre: null,\n        apellidos: null,\n        dirección: null,\n        email: null,\n        fecha_nacimiento: null,\n        especialidad_id: null,\n        telefono: null,\n        vigente: true\n    },\n    dialog: false,\n    editedIndex: -1,\n    formCrear: \"Nuevo profesional\",\n    formEdit: \"Editar datos del profesional\",\n    formItems: [],\n    formTitle: \"Gestión de Profesionales\",\n    list: [],\n    loadingSearch: false,\n    tableItems: [],\n});\nconst date = useDate();\n\n//**********\\\\\\\\  LIFE CYCLE HOOKS ////*************/\nonMounted(async () => {\n    state.list = await fetchAllData(state.endpoints);\n});\n\n//**********\\\\\\\\  COMPUTE PROPERTIES ////*************/\nconst editedItemTitle = computed(() =>\n    state.editedIndex === -1 ? state.formCrear : state.formEdit\n);\n\n//**********\\\\\\\\ METHODS ////*************/\nconst formatDate = computed(() => {\n    let formatted = moment(state.editedItem.fecha_nacimiento).format(\n        \"DD/MM/YYYY\"\n    );\n    return formatted;\n});\n\nfunction fichaMedica(item) {\n    store.selected = item;\n    try {\n        router.get(\"/ficha\");\n    } catch (error) {\n        console.error(\n          //  '\"An error occurred while fetching daily attention data.\"'\n        );\n    }\n}\n\nfunction asignacion(item) {\n    store.selected = item;\n    try {\n        router.get(\"/asignacion\");\n    } catch (error) {\n       // console.error(\"An error occurred while fetching daily attention data.\");\n    }\n}\n\nfunction close() {\n    closeForm(state);\n}\n\nfunction calcEdad(fecNac) {\n    let now = new Date();\n    let birthDate = new Date(fecNac);\n    let age = now.getFullYear() - birthDate.getFullYear();\n    return age;\n}\n\nconst handleInputChange = () => {\n    let fecNac = state.editedItem.fecha_nacimiento;\n    let age = calcEdad(fecNac);\n    state.editedItem.edad = ref(age);\n};\n\n//**********\\\\\\\\  CRUD ////*************/\nconst isObjectNullOrEmpty = (obj) => {\n    return Object.values(obj).every((value) => value === null || value === \"\");\n};\n\nconst show = () => {\n    if (isObjectNullOrEmpty(state.searchQuery)) {\n        Swal.fire({\n        title: '¿Quieres desplegar todos los registros?',\n        text: \"Esta acción puede tardar un poco.\",\n        icon: 'warning',\n        showCancelButton: true,\n        cancelButtonText: 'Cancelar'\n      }).then((result) => {\n        if (result.isConfirmed) {\n          // Acción a realizar si el usuario acepta\n          console.log('Desplegando todos los registros...');\n        } else {\n          // Acción a realizar si el usuario cancela\n          console.log('Acción cancelada.');\n        }\n      });\n    } else {\n        console.log(state.searchQuery);\n    }\n};\n\nfunction openFormCreate() {\n    openToCreate(state);\n}\n\nfunction storeItems() {\n    return state.editedIndex > -1 ? update() : create();\n}\n\nconst create = async () => {\n    await handleStoreItem(state);\n    closeForm(state);\n};\n\nfunction fichaPersonal(item) {\n    openToEdit(state, item);\n    handleInputChange();\n}\n\nconst update = async () => {\n    await handleEditItem(state);\n    closeForm(state);\n};\n\nconst remove = async (item) => {\n    handleRemoveItem(state, item);\n};\n</script>\n\n<template>\n    <v-container fluid>\n        <v-sheet color=\"white\" :elevation=\"6\" :class=\"'rounded-lg ma-2 pa-2'\">\n            <div class=\"text-h6 ma-2\">{{ state.formTitle }}</div>\n            <v-divider thickness=\"4px\" color=\"#009AA4\"></v-divider>\n            <v-form fast-fail @submit.prevent>\n                <v-row>\n                    <v-col>\n                        <v-text-field\n                            v-model=\"state.searchQuery.rut\"\n                            :rules=\"state.validation.rutRules\"\n                            label=\"Rut* (12345678-9)\"\n                            class=\"ma-2\"\n                            type=\"text\"\n                            variant=\"underlined\"\n                            clearable\n                        ></v-text-field>\n                        <v-select\n                            :items=\"state.list.especialidad\"\n                            clearable\n                            label=\"Especialidad\"\n                            class=\"ma-2\"\n                            variant=\"underlined\"\n                            single\n                        ></v-select>\n                    </v-col>\n                </v-row>\n\n                <v-row>\n                    <v-btn\n                        prepend-icon=\"mdi-file-search\"\n                        variant=\"tonal\"\n                        class=\"ma-4\"\n                        color=\"#009AA4\"\n                        :loading=\"state.loadingSearch\"\n                        type=\"submit\"\n                        @click=\"show\"\n                    >\n                        Buscar\n                    </v-btn>\n\n                    <v-btn\n                        prepend-icon=\"mdi-cloud-download\"\n                        variant=\"tonal\"\n                        class=\"ma-4\"\n                        color=\"#009AA4\"\n                    >\n                        <download-excel\n                            :data=\"state.tableItems\"\n                            name=\"consulta_paciente.xls\"\n                        >\n                            Bajar archivo\n                        </download-excel>\n                    </v-btn>\n                </v-row>\n            </v-form>\n        </v-sheet>\n\n        <v-sheet color=\"white\" :elevation=\"6\" :class=\"'rounded-lg ma-2 pa-2'\">\n            <v-data-table\n                :headers=\"state.headers\"\n                :items=\"state.tableItems\"\n                :sort-by=\"[{ key: 'apellidos', order: 'asc' }]\"\n            >\n                <template v-slot:top>\n                    <v-toolbar flat>\n                        <v-btn\n                            icon=\"mdi-account-multiple-plus\"\n                            variant=\"tonal\"\n                            class=\"ma-2\"\n                            color=\"#009AA4\"\n                            @click=\"openFormCreate\"\n                        >\n                        </v-btn>\n\n                        <v-dialog v-model=\"state.dialog\" persistent>\n                            <v-form fast-fail @submit.prevent>\n                                <v-card>\n                                    <v-card-title>\n                                        <div class=\"text-h6 ma-2\">\n                                            {{ editedItemTitle }}\n                                        </div>\n                                        <v-divider\n                                            thickness=\"4px\"\n                                            color=\"#662d91\"\n                                        ></v-divider>\n                                    </v-card-title>\n                                    <v-card-text>\n                                        <div class=\"text-h6\">\n                                            Datos Personales\n                                        </div>\n                                        <v-spacer></v-spacer>\n                                        <v-row>\n                                            <v-col cols=\"3\">\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem.rut\n                                                    \"\n                                                    label=\"Rut* (12345678-9)\"\n                                                    type=\"text\"\n                                                    required\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem.nombre\n                                                    \"\n                                                    label=\"Nombre*\"\n                                                    type=\"text\"\n                                                    required\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem\n                                                            .apellidos\n                                                    \"\n                                                    label=\"Apellidos*\"\n                                                    required\n                                                    type=\"text\"\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem.email\n                                                    \"\n                                                    :rules=\"\n                                                        state.validationSchema\n                                                            .emailRules\n                                                    \"\n                                                    label=\"Email\"\n                                                    type=\"email\"\n                                                    required\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n                                            </v-col>\n\n                                            <v-col cols=\"3\">\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem\n                                                            .direccion\n                                                    \"\n                                                    label=\"Dirección\"\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n\n                                                <v-text-field\n                                                    label=\"teléfono 1\"\n                                                    v-model=\"\n                                                        state.editedItem\n                                                            .telefono1\n                                                    \"\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n                                                <v-text-field\n                                                    v-model=\"\n                                                        state.editedItem\n                                                            .telefono2\n                                                    \"\n                                                    label=\"teléfono 2\"\n                                                    clearable\n                                                    variant=\"underlined\"\n                                                ></v-text-field>\n                                                <v-select\n                                                    :items=\"[\n                                                        'Psicologia',\n                                                        'Kine',\n                                                        'Terapia Ocupacional',\n                                                    ]\"\n                                                    clearable\n                                                    label=\"Especialidad\"\n                                                    variant=\"underlined\"\n                                                    single\n                                                ></v-select>\n                                            </v-col>\n\n                                            <v-col>\n                                                <v-data-table\n                                                    :headers=\"\n                                                        state.horario.headers\n                                                    \"\n                                                    :items=\"state.horario.items\"\n                                                    class=\"elevation-1\"\n                                                >\n                                                    <template v-slot:top>\n                                                        <v-toolbar flat>\n                                                            <v-toolbar-title\n                                                                >Disponibilidad\n                                                                horaria</v-toolbar-title\n                                                            >\n                                                            <v-divider\n                                                                class=\"mx-4\"\n                                                                inset\n                                                                vertical\n                                                            ></v-divider>\n                                                        </v-toolbar>\n                                                    </template>\n                                                    <template\n                                                        v-slot:item.disponible=\"{\n                                                            item,\n                                                        }\"\n                                                    >\n                                                        <v-chip\n                                                            :color=\"\n                                                                item.disponible ===\n                                                                'S'\n                                                                    ? 'green'\n                                                                    : 'red'\n                                                            \"\n                                                            dark\n                                                        >\n                                                            {{\n                                                                item.disponible\n                                                            }}\n                                                        </v-chip>\n                                                    </template>\n                                                </v-data-table>\n                                            </v-col>\n                                        </v-row>\n                                    </v-card-text>\n                                    <v-card-actions>\n                                        <v-spacer></v-spacer>\n                                        <v-btn\n                                            color=\"#009AA4\"\n                                            variant=\"tonal\"\n                                            @click=\"close\"\n                                        >\n                                            Cancelar\n                                        </v-btn>\n                                        <v-btn\n                                            color=\"#009AA4\"\n                                            variant=\"tonal\"\n                                            @click=\"storeItems\"\n                                        >\n                                            Guardar\n                                        </v-btn>\n                                    </v-card-actions>\n                                </v-card>\n                            </v-form>\n                        </v-dialog>\n                    </v-toolbar>\n                </template>\n\n                <template v-slot:item.actions=\"{ item }\">\n                    <v-tooltip text=\"Asignacion de Servicio\" location=\"top\">\n                        <template v-slot:activator=\"{ props }\">\n                            <v-btn\n                                v-bind=\"props\"\n                                density=\"compact\"\n                                color=\"#009AA4\"\n                                class=\"mr-2 ml-2\"\n                                :icon=\"'mdi-medical-bag'\"\n                                variant=\"tonal\"\n                                @click=\"asignacion(item)\"\n                            ></v-btn>\n                        </template>\n                    </v-tooltip>\n                    <v-tooltip text=\"Ficha Médica\" location=\"top\">\n                        <template v-slot:activator=\"{ props }\">\n                            <v-btn\n                                v-bind=\"props\"\n                                density=\"compact\"\n                                color=\"#009AA4\"\n                                class=\"mr-2 ml-2\"\n                                variant=\"tonal\"\n                                :icon=\"'mdi-stethoscope'\"\n                                @click=\"fichaMedica(item)\"\n                            ></v-btn>\n                        </template>\n                    </v-tooltip>\n                    <v-tooltip text=\"Datos Personales\" location=\"top\">\n                        <template v-slot:activator=\"{ props }\">\n                            <v-btn\n                                v-bind=\"props\"\n                                density=\"compact\"\n                                class=\"mr-2 ml-2\"\n                                color=\"#009AA4\"\n                                variant=\"tonal\"\n                                :icon=\"'mdi-account-edit-outline'\"\n                                @click=\"fichaPersonal(item)\"\n                            ></v-btn>\n                        </template>\n                    </v-tooltip>\n                    <v-tooltip text=\"Eliminar\" location=\"top\">\n                        <template v-slot:activator=\"{ props }\">\n                            <v-btn\n                                v-bind=\"props\"\n                                density=\"compact\"\n                                class=\"mr-2 ml-2\"\n                                color=\"#009AA4\"\n                                variant=\"tonal\"\n                                :icon=\"'mdi-delete-outline'\"\n                                @click=\"remove(item)\"\n                            ></v-btn>\n                        </template>\n                    </v-tooltip>\n                </template>\n            </v-data-table>\n        </v-sheet>\n    </v-container>\n</template>\n"],"names":["store","useDataStore","state","reactive","value","splitidRut","num","dv","s","dvEsperado","useDate","onMounted","fetchAllData","editedItemTitle","computed","moment","fichaMedica","item","router","asignacion","close","closeForm","calcEdad","fecNac","now","birthDate","handleInputChange","age","ref","isObjectNullOrEmpty","obj","show","Swal","result","openFormCreate","openToCreate","storeItems","update","create","handleStoreItem","fichaPersonal","openToEdit","handleEditItem","remove","handleRemoveItem"],"mappings":"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"}